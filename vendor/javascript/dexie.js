// dexie@2.0.4 downloaded from https://ga.jspm.io/npm:dexie@2.0.4/dist/dexie.js

import e from"process";var n="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global;var t={};var r=e;(function(e,n){t=n()})(t,(function(){var e=Object.keys;var t=Array.isArray;var i="undefined"!==typeof self?self:"undefined"!==typeof window?window:n;function extend(n,t){if("object"!==typeof t)return n;e(t).forEach((function(e){n[e]=t[e]}));return n}var o=Object.getPrototypeOf;var a={}.hasOwnProperty;function hasOwn(e,n){return a.call(e,n)}function props(n,t){"function"===typeof t&&(t=t(o(n)));e(t).forEach((function(e){setProp(n,e,t[e])}))}var s=Object.defineProperty;function setProp(e,n,t,r){s(e,n,extend(t&&hasOwn(t,"get")&&"function"===typeof t.get?{get:t.get,set:t.set,configurable:true}:{value:t,configurable:true,writable:true},r))}function derive(e){return{from:function(n){e.prototype=Object.create(n.prototype);setProp(e.prototype,"constructor",e);return{extend:props.bind(null,e.prototype)}}}}var u=Object.getOwnPropertyDescriptor;function getPropertyDescriptor(e,n){var t=u(e,n),r;return t||(r=o(e))&&getPropertyDescriptor(r,n)}var l=[].slice;function slice(e,n,t){return l.call(e,n,t)}function override(e,n){return n(e)}function assert(e){if(!e)throw new Error("Assertion Failed")}function asap(e){i.setImmediate?r.nextTick(e):setTimeout(e,0)}function arrayToObject(e,n){return e.reduce((function(e,t,r){var i=n(t,r);i&&(e[i[0]]=i[1]);return e}),{})}function trycatcher(e,t){return function(){try{e.apply(this||n,arguments)}catch(e){t(e)}}}function tryCatch(e,n,t){try{e.apply(null,t)}catch(e){n&&n(e)}}function getByKeyPath(e,n){if(hasOwn(e,n))return e[n];if(!n)return e;if("string"!==typeof n){var t=[];for(var r=0,i=n.length;r<i;++r){var o=getByKeyPath(e,n[r]);t.push(o)}return t}var a=n.indexOf(".");if(-1!==a){var s=e[n.substr(0,a)];return void 0===s?void 0:getByKeyPath(s,n.substr(a+1))}}function setByKeyPath(e,n,t){if(e&&void 0!==n&&(!("isFrozen"in Object)||!Object.isFrozen(e)))if("string"!==typeof n&&"length"in n){assert("string"!==typeof t&&"length"in t);for(var r=0,i=n.length;r<i;++r)setByKeyPath(e,n[r],t[r])}else{var o=n.indexOf(".");if(-1!==o){var a=n.substr(0,o);var s=n.substr(o+1);if(""===s)void 0===t?delete e[a]:e[a]=t;else{var u=e[a];u||(u=e[a]={});setByKeyPath(u,s,t)}}else void 0===t?delete e[n]:e[n]=t}}function delByKeyPath(e,n){"string"===typeof n?setByKeyPath(e,n,void 0):"length"in n&&[].map.call(n,(function(n){setByKeyPath(e,n,void 0)}))}function shallowClone(e){var n={};for(var t in e)hasOwn(e,t)&&(n[t]=e[t]);return n}var f=[].concat;function flatten(e){return f.apply([],e)}var h="Boolean,String,Date,RegExp,Blob,File,FileList,ArrayBuffer,DataView,Uint8ClampedArray,ImageData,Map,Set".split(",").concat(flatten([8,16,32,64].map((function(e){return["Int","Uint","Float"].map((function(n){return n+e+"Array"}))})))).filter((function(e){return i[e]})).map((function(e){return i[e]}));function deepClone(e){if(!e||"object"!==typeof e)return e;var n;if(t(e)){n=[];for(var r=0,i=e.length;r<i;++r)n.push(deepClone(e[r]))}else if(h.indexOf(e.constructor)>=0)n=e;else{n=e.constructor?Object.create(e.constructor.prototype):{};for(var o in e)hasOwn(e,o)&&(n[o]=deepClone(e[o]))}return n}function getObjectDiff(n,t,r,i){r=r||{};i=i||"";e(n).forEach((function(e){if(hasOwn(t,e)){var o=n[e],a=t[e];"object"===typeof o&&"object"===typeof a&&o&&a&&""+o.constructor===""+a.constructor?getObjectDiff(o,a,r,i+e+"."):o!==a&&(r[i+e]=t[e])}else r[i+e]=void 0}));e(t).forEach((function(e){hasOwn(n,e)||(r[i+e]=t[e])}));return r}var d="undefined"!==typeof Symbol&&Symbol.iterator;var p=d?function(e){var n;return null!=e&&(n=e[d])&&n.apply(e)}:function(){return null};var v={};function getArrayOf(e){var r,i,o,a;if(1===arguments.length){if(t(e))return e.slice();if((this||n)===v&&"string"===typeof e)return[e];if(a=p(e)){i=[];while(o=a.next(),!o.done)i.push(o.value);return i}if(null==e)return[e];r=e.length;if("number"===typeof r){i=new Array(r);while(r--)i[r]=e[r];return i}return[e]}r=arguments.length;i=new Array(r);while(r--)i[r]=arguments[r];return i}var y="undefined"!==typeof location&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function setDebug(e,n){y=e;libraryFilter=n}var libraryFilter=function(){return true};var m=!new Error("").stack;function getErrorWithStack(){if(m)try{getErrorWithStack.arguments;throw new Error}catch(e){return e}return new Error}function prettyStack(e,n){var t=e.stack;if(!t)return"";n=n||0;0===t.indexOf(e.name)&&(n+=(e.name+e.message).split("\n").length);return t.split("\n").slice(n).filter(libraryFilter).map((function(e){return"\n"+e})).join("")}function deprecated(e,t){return function(){console.warn(e+" is deprecated. See https://github.com/dfahlander/Dexie.js/wiki/Deprecations. "+prettyStack(getErrorWithStack(),1));return t.apply(this||n,arguments)}}var g=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"];var b=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"];var w=g.concat(b);var k={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed"};function DexieError(e,t){(this||n)._e=getErrorWithStack();(this||n).name=e;(this||n).message=t}derive(DexieError).from(Error).extend({stack:{get:function(){return(this||n)._stack||((this||n)._stack=(this||n).name+": "+(this||n).message+prettyStack((this||n)._e,2))}},toString:function(){return(this||n).name+": "+(this||n).message}});function getMultiErrorMessage(e,n){return e+". Errors: "+n.map((function(e){return e.toString()})).filter((function(e,n,t){return t.indexOf(e)===n})).join("\n")}function ModifyError(e,t,r,i){(this||n)._e=getErrorWithStack();(this||n).failures=t;(this||n).failedKeys=i;(this||n).successCount=r}derive(ModifyError).from(DexieError);function BulkError(e,t){(this||n)._e=getErrorWithStack();(this||n).name="BulkError";(this||n).failures=t;(this||n).message=getMultiErrorMessage(e,t)}derive(BulkError).from(DexieError);var _=w.reduce((function(e,n){return e[n]=n+"Error",e}),{});var x=DexieError;var P=w.reduce((function(e,t){var r=t+"Error";function DexieError(e,i){(this||n)._e=getErrorWithStack();(this||n).name=r;if(e){if("string"===typeof e){(this||n).message=e;(this||n).inner=i||null}else if("object"===typeof e){(this||n).message=e.name+" "+e.message;(this||n).inner=e}}else{(this||n).message=k[t]||r;(this||n).inner=null}}derive(DexieError).from(x);e[t]=DexieError;return e}),{});P.Syntax=SyntaxError;P.Type=TypeError;P.Range=RangeError;var S=b.reduce((function(e,n){e[n+"Error"]=P[n];return e}),{});function mapError(e,t){if(!e||e instanceof DexieError||e instanceof TypeError||e instanceof SyntaxError||!e.name||!S[e.name])return e;var r=new S[e.name](t||e.message,e);"stack"in e&&setProp(r,"stack",{get:function(){return(this||n).inner.stack}});return r}var E=w.reduce((function(e,n){-1===["Syntax","Type","Range"].indexOf(n)&&(e[n+"Error"]=P[n]);return e}),{});E.ModifyError=ModifyError;E.DexieError=DexieError;E.BulkError=BulkError;function nop(){}function mirror(e){return e}function pureFunctionChain(e,n){return null==e||e===mirror?n:function(t){return n(e(t))}}function callBoth(e,t){return function(){e.apply(this||n,arguments);t.apply(this||n,arguments)}}function hookCreatingChain(e,t){return e===nop?t:function(){var r=e.apply(this||n,arguments);void 0!==r&&(arguments[0]=r);var i=(this||n).onsuccess,o=(this||n).onerror;(this||n).onsuccess=null;(this||n).onerror=null;var a=t.apply(this||n,arguments);i&&((this||n).onsuccess=(this||n).onsuccess?callBoth(i,(this||n).onsuccess):i);o&&((this||n).onerror=(this||n).onerror?callBoth(o,(this||n).onerror):o);return void 0!==a?a:r}}function hookDeletingChain(e,t){return e===nop?t:function(){e.apply(this||n,arguments);var r=(this||n).onsuccess,i=(this||n).onerror;(this||n).onsuccess=(this||n).onerror=null;t.apply(this||n,arguments);r&&((this||n).onsuccess=(this||n).onsuccess?callBoth(r,(this||n).onsuccess):r);i&&((this||n).onerror=(this||n).onerror?callBoth(i,(this||n).onerror):i)}}function hookUpdatingChain(e,t){return e===nop?t:function(r){var i=e.apply(this||n,arguments);extend(r,i);var o=(this||n).onsuccess,a=(this||n).onerror;(this||n).onsuccess=null;(this||n).onerror=null;var s=t.apply(this||n,arguments);o&&((this||n).onsuccess=(this||n).onsuccess?callBoth(o,(this||n).onsuccess):o);a&&((this||n).onerror=(this||n).onerror?callBoth(a,(this||n).onerror):a);return void 0===i?void 0===s?void 0:s:extend(i,s)}}function reverseStoppableEventChain(e,t){return e===nop?t:function(){return false!==t.apply(this||n,arguments)&&e.apply(this||n,arguments)}}function promisableChain(e,t){return e===nop?t:function(){var r=e.apply(this||n,arguments);if(r&&"function"===typeof r.then){var i=this||n,o=arguments.length,a=new Array(o);while(o--)a[o]=arguments[o];return r.then((function(){return t.apply(i,a)}))}return t.apply(this||n,arguments)}}var C={};var T=100;var D=20;var j=7;var A=function(){try{return new Function("let F=async ()=>{},p=F();return [p,Object.getPrototypeOf(p),Promise.resolve(),F.constructor];")()}catch(n){var e=i.Promise;return e?[e.resolve(),e.prototype,e.resolve()]:[]}}();var O=A[0];var I=A[1];var B=A[2];var K=I&&I.then;var R=O&&O.constructor;var F=A[3];var M=!!B;var N=false;var H=B?function(){B.then(physicalTick)}:i.setImmediate?r.nextTick.bind(null,physicalTick):i.MutationObserver?function(){var e=document.createElement("div");new MutationObserver((function(){physicalTick();e=null})).observe(e,{attributes:true});e.setAttribute("i","1")}:function(){setTimeout(physicalTick,0)};var asap$1=function(e,n){Z.push([e,n]);if(q){H();q=false}};var W=true;var q=true;var U=[];var L=[];var z=null;var V=mirror;var Q={id:"global",global:true,ref:0,unhandleds:[],onunhandled:globalError,pgp:false,env:{},finalize:function(){(this||n).unhandleds.forEach((function(e){try{globalError(e[0],e[1])}catch(e){}}))}};var G=Q;var Z=[];var J=0;var Y=[];function Promise(e){if("object"!==typeof(this||n))throw new TypeError("Promises must be constructed via new");(this||n)._listeners=[];(this||n).onuncatched=nop;(this||n)._lib=false;var t=(this||n)._PSD=G;if(y){(this||n)._stackHolder=getErrorWithStack();(this||n)._prev=null;(this||n)._numPrev=0}if("function"===typeof e){(this||n)._state=null;(this||n)._value=null;++t.ref;executePromiseTask(this||n,e)}else{if(e!==C)throw new TypeError("Not a function");(this||n)._state=arguments[1];(this||n)._value=arguments[2];false===(this||n)._state&&handleRejection(this||n,(this||n)._value)}}var $={get:function(){var e=G,t=re;function then(r,i){var o=this||n;var a=!e.global&&(e!==G||t!==re);a&&decrementExpectedAwaits();var s=new Promise((function(n,t){propagateToListener(o,new Listener(nativeAwaitCompatibleWrap(r,e,a),nativeAwaitCompatibleWrap(i,e,a),n,t,e))}));y&&linkToPreviousPromise(s,this||n);return s}then.prototype=C;return then},set:function(e){setProp(this||n,"then",e&&e.prototype===C?$:{get:function(){return e},set:$.set})}};props(Promise.prototype,{then:$,_then:function(e,t){propagateToListener(this||n,new Listener(null,null,e,t,G))},catch:function(e){if(1===arguments.length)return this.then(null,e);var n=arguments[0],t=arguments[1];return"function"===typeof n?this.then(null,(function(e){return e instanceof n?t(e):PromiseReject(e)})):this.then(null,(function(e){return e&&e.name===n?t(e):PromiseReject(e)}))},finally:function(e){return this.then((function(n){e();return n}),(function(n){e();return PromiseReject(n)}))},stack:{get:function(){if((this||n)._stack)return(this||n)._stack;try{N=true;var e=getStack(this||n,[],D);var t=e.join("\nFrom previous: ");null!==(this||n)._state&&((this||n)._stack=t);return t}finally{N=false}}},timeout:function(e,t){var r=this||n;return e<Infinity?new Promise((function(n,i){var o=setTimeout((function(){return i(new P.Timeout(t))}),e);r.then(n,i).finally(clearTimeout.bind(null,o))})):this||n}});"undefined"!==typeof Symbol&&Symbol.toStringTag&&setProp(Promise.prototype,Symbol.toStringTag,"Promise");Q.env=snapShot();function Listener(e,t,r,i,o){(this||n).onFulfilled="function"===typeof e?e:null;(this||n).onRejected="function"===typeof t?t:null;(this||n).resolve=r;(this||n).reject=i;(this||n).psd=o}props(Promise,{all:function(){var e=getArrayOf.apply(null,arguments).map(onPossibleParallellAsync);return new Promise((function(n,t){0===e.length&&n([]);var r=e.length;e.forEach((function(i,o){return Promise.resolve(i).then((function(t){e[o]=t;--r||n(e)}),t)}))}))},resolve:function(e){if(e instanceof Promise)return e;if(e&&"function"===typeof e.then)return new Promise((function(n,t){e.then(n,t)}));var n=new Promise(C,true,e);linkToPreviousPromise(n,z);return n},reject:PromiseReject,race:function(){var e=getArrayOf.apply(null,arguments).map(onPossibleParallellAsync);return new Promise((function(n,t){e.map((function(e){return Promise.resolve(e).then(n,t)}))}))},PSD:{get:function(){return G},set:function(e){return G=e}},newPSD:newScope,usePSD:usePSD,scheduler:{get:function(){return asap$1},set:function(e){asap$1=e}},rejectionMapper:{get:function(){return V},set:function(e){V=e}},follow:function(e,t){return new Promise((function(r,i){return newScope((function(t,r){var i=G;i.unhandleds=[];i.onunhandled=r;i.finalize=callBoth((function(){var e=this||n;run_at_end_of_this_or_next_physical_tick((function(){0===e.unhandleds.length?t():r(e.unhandleds[0])}))}),i.finalize);e()}),t,r,i)}))}});function executePromiseTask(e,n){try{n((function(n){if(null===e._state){if(n===e)throw new TypeError("A promise cannot be resolved with itself.");var t=e._lib&&beginMicroTickScope();if(n&&"function"===typeof n.then)executePromiseTask(e,(function(e,t){n instanceof Promise?n._then(e,t):n.then(e,t)}));else{e._state=true;e._value=n;propagateAllListeners(e)}t&&endMicroTickScope()}}),handleRejection.bind(null,e))}catch(n){handleRejection(e,n)}}function handleRejection(e,n){L.push(n);if(null===e._state){var t=e._lib&&beginMicroTickScope();n=V(n);e._state=false;e._value=n;y&&null!==n&&"object"===typeof n&&!n._promise&&tryCatch((function(){var t=getPropertyDescriptor(n,"stack");n._promise=e;setProp(n,"stack",{get:function(){return N?t&&(t.get?t.get.apply(n):t.value):e.stack}})}));addPossiblyUnhandledError(e);propagateAllListeners(e);t&&endMicroTickScope()}}function propagateAllListeners(e){var n=e._listeners;e._listeners=[];for(var t=0,r=n.length;t<r;++t)propagateToListener(e,n[t]);var i=e._PSD;--i.ref||i.finalize();if(0===J){++J;asap$1((function(){0===--J&&finalizePhysicalTick()}),[])}}function propagateToListener(e,n){if(null!==e._state){var t=e._state?n.onFulfilled:n.onRejected;if(null===t)return(e._state?n.resolve:n.reject)(e._value);++n.psd.ref;++J;asap$1(callListener,[t,e,n])}else e._listeners.push(n)}function callListener(e,n,t){try{z=n;var r,i=n._value;if(n._state)r=e(i);else{L.length&&(L=[]);r=e(i);-1===L.indexOf(i)&&markErrorAsHandled(n)}t.resolve(r)}catch(e){t.reject(e)}finally{z=null;0===--J&&finalizePhysicalTick();--t.psd.ref||t.psd.finalize()}}function getStack(e,n,t){if(n.length===t)return n;var r="";if(false===e._state){var i=e._value,o,a;if(null!=i){o=i.name||"Error";a=i.message||i;r=prettyStack(i,0)}else{o=i;a=""}n.push(o+(a?": "+a:"")+r)}if(y){r=prettyStack(e._stackHolder,2);r&&-1===n.indexOf(r)&&n.push(r);e._prev&&getStack(e._prev,n,t)}return n}function linkToPreviousPromise(e,n){var t=n?n._numPrev+1:0;if(t<T){e._prev=n;e._numPrev=t}}function physicalTick(){beginMicroTickScope()&&endMicroTickScope()}function beginMicroTickScope(){var e=W;W=false;q=false;return e}function endMicroTickScope(){var e,n,t;do{while(Z.length>0){e=Z;Z=[];t=e.length;for(n=0;n<t;++n){var r=e[n];r[0].apply(null,r[1])}}}while(Z.length>0);W=true;q=true}function finalizePhysicalTick(){var e=U;U=[];e.forEach((function(e){e._PSD.onunhandled.call(null,e._value,e)}));var n=Y.slice(0);var t=n.length;while(t)n[--t]()}function run_at_end_of_this_or_next_physical_tick(e){function finalizer(){e();Y.splice(Y.indexOf(finalizer),1)}Y.push(finalizer);++J;asap$1((function(){0===--J&&finalizePhysicalTick()}),[])}function addPossiblyUnhandledError(e){U.some((function(n){return n._value===e._value}))||U.push(e)}function markErrorAsHandled(e){var n=U.length;while(n)if(U[--n]._value===e._value){U.splice(n,1);return}}function PromiseReject(e){return new Promise(C,false,e)}function wrap(e,t){var r=G;return function(){var i=beginMicroTickScope(),o=G;try{switchToZone(r,true);return e.apply(this||n,arguments)}catch(e){t&&t(e)}finally{switchToZone(o,false);i&&endMicroTickScope()}}}var X={awaits:0,echoes:0,id:0};var ee=0;var ne=[];var te=0;var re=0;var ie=0;function newScope(e,t,r,i){var o=G,a=Object.create(o);a.parent=o;a.ref=0;a.global=false;a.id=++ie;var s=Q.env;a.env=M?{Promise:Promise,PromiseProp:{value:Promise,configurable:true,writable:true},all:Promise.all,race:Promise.race,resolve:Promise.resolve,reject:Promise.reject,nthen:getPatchedPromiseThen(s.nthen,a),gthen:getPatchedPromiseThen(s.gthen,a)}:{};t&&extend(a,t);++o.ref;a.finalize=function(){--(this||n).parent.ref||(this||n).parent.finalize()};var u=usePSD(a,e,r,i);0===a.ref&&a.finalize();return u}function incrementExpectedAwaits(){X.id||(X.id=++ee);++X.awaits;X.echoes+=j;return X.id}function decrementExpectedAwaits(e){if(X.awaits&&(!e||e===X.id)){0===--X.awaits&&(X.id=0);X.echoes=X.awaits*j}}function onPossibleParallellAsync(e){if(X.echoes&&e&&e.constructor===R){incrementExpectedAwaits();return e.then((function(e){decrementExpectedAwaits();return e}),(function(e){decrementExpectedAwaits();return ae(e)}))}return e}function zoneEnterEcho(e){++re;X.echoes&&0!==--X.echoes||(X.echoes=X.id=0);ne.push(G);switchToZone(e,true)}function zoneLeaveEcho(){var e=ne[ne.length-1];ne.pop();switchToZone(e,false)}function switchToZone(e,n){var t=G;(n?!X.echoes||te++&&e===G:!te||--te&&e===G)||enqueueNativeMicroTask(n?zoneEnterEcho.bind(null,e):zoneLeaveEcho);if(e!==G){G=e;t===Q&&(Q.env=snapShot());if(M){var r=Q.env.Promise;var o=e.env;I.then=o.nthen;r.prototype.then=o.gthen;if(t.global||e.global){Object.defineProperty(i,"Promise",o.PromiseProp);r.all=o.all;r.race=o.race;r.resolve=o.resolve;r.reject=o.reject}}}}function snapShot(){var e=i.Promise;return M?{Promise:e,PromiseProp:Object.getOwnPropertyDescriptor(i,"Promise"),all:e.all,race:e.race,resolve:e.resolve,reject:e.reject,nthen:I.then,gthen:e.prototype.then}:{}}function usePSD(e,n,t,r,i){var o=G;try{switchToZone(e,true);return n(t,r,i)}finally{switchToZone(o,false)}}function enqueueNativeMicroTask(e){K.call(O,e)}function nativeAwaitCompatibleWrap(e,t,r){return"function"!==typeof e?e:function(){var i=G;r&&incrementExpectedAwaits();switchToZone(t,true);try{return e.apply(this||n,arguments)}finally{switchToZone(i,false)}}}function getPatchedPromiseThen(e,t){return function(r,i){return e.call(this||n,nativeAwaitCompatibleWrap(r,t,false),nativeAwaitCompatibleWrap(i,t,false))}}var oe="unhandledrejection";function globalError(e,n){var t;try{t=n.onuncatched(e)}catch(e){}if(false!==t)try{var r,o={promise:n,reason:e};if(i.document&&document.createEvent){r=document.createEvent("Event");r.initEvent(oe,true,true);extend(r,o)}else if(i.CustomEvent){r=new CustomEvent(oe,{detail:o});extend(r,o)}if(r&&i.dispatchEvent){dispatchEvent(r);if(!i.PromiseRejectionEvent&&i.onunhandledrejection)try{i.onunhandledrejection(r)}catch(e){}}r.defaultPrevented||console.warn("Unhandled rejection: "+(e.stack||e))}catch(e){}}var ae=Promise.reject;function Events(n){var r={};var rv=function(e,t){if(t){var i=arguments.length,o=new Array(i-1);while(--i)o[i-1]=arguments[i];r[e].subscribe.apply(null,o);return n}if("string"===typeof e)return r[e]};rv.addEventType=add;for(var i=1,o=arguments.length;i<o;++i)add(arguments[i]);return rv;function add(e,n,t){if("object"===typeof e)return addConfiguredEvents(e);n||(n=reverseStoppableEventChain);t||(t=nop);var i={subscribers:[],fire:t,subscribe:function(e){if(-1===i.subscribers.indexOf(e)){i.subscribers.push(e);i.fire=n(i.fire,e)}},unsubscribe:function(e){i.subscribers=i.subscribers.filter((function(n){return n!==e}));i.fire=i.subscribers.reduce(n,t)}};r[e]=rv[e]=i;return i}function addConfiguredEvents(n){e(n).forEach((function(e){var r=n[e];if(t(r))add(e,n[e][0],n[e][1]);else{if("asap"!==r)throw new P.InvalidArgument("Invalid event config");var i=add(e,mirror,(function fire(){var e=arguments.length,n=new Array(e);while(e--)n[e]=arguments[e];i.subscribers.forEach((function(e){asap((function fireEvent(){e.apply(null,n)}))}))}))}}))}}var se="2.0.4";var ue=String.fromCharCode(65535);var ce=function(){try{IDBKeyRange.only([[]]);return[[]]}catch(e){return ue}}();var le=-Infinity;var fe="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.";var he="String expected.";var de=[];var pe="undefined"!==typeof navigator&&/(MSIE|Trident|Edge)/.test(navigator.userAgent);var ve=pe;var ye=pe;var dexieStackFrameFilter=function(e){return!/(dexie\.js|dexie\.min\.js)/.test(e)};var me;setDebug(y,dexieStackFrameFilter);function Dexie(r,o){var a=Dexie.dependencies;var s=extend({addons:Dexie.addons,autoOpen:true,indexedDB:a.indexedDB,IDBKeyRange:a.IDBKeyRange},o);var u=s.addons,l=s.autoOpen,f=s.indexedDB,h=s.IDBKeyRange;var d=(this||n)._dbSchema={};var p=[];var m=[];var g={};var b=null;var w=null;var k=false;var _=null;var x=false;var S="readonly",E="readwrite";var C=this||n;var T,D=new Promise((function(e){T=e})),j,A=new Promise((function(e,n){j=n}));var O=true;var I=!!getNativeGetDatabaseNamesFn(f),B;function init(){C.on("versionchange",(function(e){e.newVersion>0?console.warn("Another connection wants to upgrade database '"+C.name+"'. Closing db now to resume the upgrade."):console.warn("Another connection wants to delete database '"+C.name+"'. Closing db now to resume the delete request.");C.close()}));C.on("blocked",(function(e){!e.newVersion||e.newVersion<e.oldVersion?console.warn("Dexie.delete('"+C.name+"') was blocked"):console.warn("Upgrade '"+C.name+"' blocked by other connection holding version "+e.oldVersion/10)}))}(this||n).version=function(e){if(b||k)throw new P.Schema("Cannot add version when database is open");(this||n).verno=Math.max((this||n).verno,e);var t=p.filter((function(n){return n._cfg.version===e}))[0];if(t)return t;t=new Version(e);p.push(t);p.sort(lowerVersionFirst);O=false;return t};function Version(e){(this||n)._cfg={version:e,storesSource:null,dbschema:{},tables:{},contentUpgrade:null};this.stores({})}extend(Version.prototype,{stores:function(t){(this||n)._cfg.storesSource=(this||n)._cfg.storesSource?extend((this||n)._cfg.storesSource,t):t;var r={};p.forEach((function(e){extend(r,e._cfg.storesSource)}));var i=(this||n)._cfg.dbschema={};this._parseStoresSpec(r,i);d=C._dbSchema=i;removeTablesApi([g,C,Transaction.prototype]);setApiOnPlace([g,C,Transaction.prototype,(this||n)._cfg.tables],e(i),i);m=e(i);return this||n},upgrade:function(e){(this||n)._cfg.contentUpgrade=e;return this||n},_parseStoresSpec:function(n,t){e(n).forEach((function(e){if(null!==n[e]){var r={};var i=parseIndexSyntax(n[e]);var o=i.shift();if(o.multi)throw new P.Schema("Primary key cannot be multi-valued");o.keyPath&&setByKeyPath(r,o.keyPath,o.auto?0:o.keyPath);i.forEach((function(e){if(e.auto)throw new P.Schema("Only primary key can be marked as autoIncrement (++)");if(!e.keyPath)throw new P.Schema("Index must have a name and cannot be an empty string");setByKeyPath(r,e.keyPath,e.compound?e.keyPath.map((function(){return""})):"")}));t[e]=new TableSchema(e,o,i,r)}}))}});function runUpgraders(n,t,r){var i=C._createTransaction(E,m,d);i.create(t);i._completion.catch(r);var o=i._reject.bind(i);newScope((function(){G.trans=i;if(0===n){e(d).forEach((function(e){createTable(t,e,d[e].primKey,d[e].indexes)}));Promise.follow((function(){return C.on.populate.fire(i)})).catch(o)}else updateTablesAndIndexes(n,i,t).catch(o)}))}function updateTablesAndIndexes(e,n,t){var r=[];var i=p.filter((function(n){return n._cfg.version===e}))[0];if(!i)throw new P.Upgrade("Dexie specification of currently installed DB version is missing");d=C._dbSchema=i._cfg.dbschema;var o=false;var a=p.filter((function(n){return n._cfg.version>e}));a.forEach((function(e){r.push((function(){var r=d;var i=e._cfg.dbschema;adjustToExistingIndexNames(r,t);adjustToExistingIndexNames(i,t);d=C._dbSchema=i;var a=getSchemaDiff(r,i);a.add.forEach((function(e){createTable(t,e[0],e[1].primKey,e[1].indexes)}));a.change.forEach((function(e){if(e.recreate)throw new P.Upgrade("Not yet support for changing primary key");var n=t.objectStore(e.name);e.add.forEach((function(e){addIndex(n,e)}));e.change.forEach((function(e){n.deleteIndex(e.name);addIndex(n,e)}));e.del.forEach((function(e){n.deleteIndex(e)}))}));if(e._cfg.contentUpgrade){o=true;return Promise.follow((function(){e._cfg.contentUpgrade(n)}))}}));r.push((function(n){if(!o||!ve){var t=e._cfg.dbschema;deleteRemovedTables(t,n)}}))}));function runQueue(){return r.length?Promise.resolve(r.shift()(n.idbtrans)).then(runQueue):Promise.resolve()}return runQueue().then((function(){createMissingTables(d,t)}))}function getSchemaDiff(e,n){var t={del:[],add:[],change:[]};for(var r in e)n[r]||t.del.push(r);for(r in n){var i=e[r],o=n[r];if(i){var a={name:r,def:o,recreate:false,del:[],add:[],change:[]};if(i.primKey.src!==o.primKey.src){a.recreate=true;t.change.push(a)}else{var s=i.idxByName;var u=o.idxByName;for(var l in s)u[l]||a.del.push(l);for(l in u){var f=s[l],h=u[l];f?f.src!==h.src&&a.change.push(h):a.add.push(h)}(a.del.length>0||a.add.length>0||a.change.length>0)&&t.change.push(a)}}else t.add.push([r,o])}return t}function createTable(e,n,t,r){var i=e.db.createObjectStore(n,t.keyPath?{keyPath:t.keyPath,autoIncrement:t.auto}:{autoIncrement:t.auto});r.forEach((function(e){addIndex(i,e)}));return i}function createMissingTables(n,t){e(n).forEach((function(e){t.db.objectStoreNames.contains(e)||createTable(t,e,n[e].primKey,n[e].indexes)}))}function deleteRemovedTables(e,n){for(var t=0;t<n.db.objectStoreNames.length;++t){var r=n.db.objectStoreNames[t];null==e[r]&&n.db.deleteObjectStore(r)}}function addIndex(e,n){e.createIndex(n.name,n.keyPath,{unique:n.unique,multiEntry:n.multi})}(this||n)._allTables=g;(this||n)._createTransaction=function(e,n,t,r){return new Transaction(e,n,t,r)};function tempTransaction(e,n,t){if(x||G.letThrough){var r=C._createTransaction(e,n,d);try{r.create()}catch(e){return ae(e)}return r._promise(e,(function(e,n){return newScope((function(){G.trans=r;return t(e,n,r)}))})).then((function(e){return r._completion.then((function(){return e}))}))}if(!k){if(!l)return ae(new P.DatabaseClosed);C.open().catch(nop)}return D.then((function(){return tempTransaction(e,n,t)}))}(this||n)._whenReady=function(e){return x||G.letThrough?e():new Promise((function(e,n){if(!k){if(!l){n(new P.DatabaseClosed);return}C.open().catch(nop)}D.then(e,n)})).then(e)};(this||n).verno=0;(this||n).open=function(){if(k||b)return D.then((function(){return w?ae(w):C}));y&&(A._stackHolder=getErrorWithStack());k=true;w=null;x=false;var e=T,n=null;return Promise.race([A,new Promise((function(e,t){if(!f)throw new P.MissingAPI("indexedDB API not found. If using IE10+, make sure to run your code on a server URL "+"(not locally). If using old Safari versions, make sure to include indexedDB polyfill.");var i=O?f.open(r):f.open(r,Math.round(10*C.verno));if(!i)throw new P.MissingAPI("IndexedDB API not available");i.onerror=eventRejectHandler(t);i.onblocked=wrap(fireOnBlocked);i.onupgradeneeded=wrap((function(e){n=i.transaction;if(O&&!C._allowEmptyDB){i.onerror=preventDefault;n.abort();i.result.close();var o=f.deleteDatabase(r);o.onsuccess=o.onerror=wrap((function(){t(new P.NoSuchDatabase("Database "+r+" doesnt exist"))}))}else{n.onerror=eventRejectHandler(t);var a=e.oldVersion>Math.pow(2,62)?0:e.oldVersion;runUpgraders(a/10,n,t,i)}}),t);i.onsuccess=wrap((function(){n=null;b=i.result;de.push(C);if(O)readGlobalSchema();else if(b.objectStoreNames.length>0)try{adjustToExistingIndexNames(d,b.transaction(safariMultiStoreFix(b.objectStoreNames),S))}catch(e){}b.onversionchange=wrap((function(e){C._vcFired=true;C.on("versionchange").fire(e)}));I||"__dbnames"===r||me.dbnames.put({name:r}).catch(nop);e()}),t)}))]).then((function(){_=[];return Promise.resolve(Dexie.vip(C.on.ready.fire)).then((function fireRemainders(){if(_.length>0){var e=_.reduce(promisableChain,nop);_=[];return Promise.resolve(Dexie.vip(e)).then(fireRemainders)}}))})).finally((function(){_=null})).then((function(){k=false;return C})).catch((function(e){try{n&&n.abort()}catch(e){}k=false;C.close();w=e;return ae(w)})).finally((function(){x=true;e()}))};(this||n).close=function(){var e=de.indexOf(C);e>=0&&de.splice(e,1);if(b){try{b.close()}catch(e){}b=null}l=false;w=new P.DatabaseClosed;k&&j(w);D=new Promise((function(e){T=e}));A=new Promise((function(e,n){j=n}))};(this||n).delete=function(){var e=arguments.length>0;return new Promise((function(n,t){if(e)throw new P.InvalidArgument("Arguments not allowed in db.delete()");k?D.then(doDelete):doDelete();function doDelete(){C.close();var e=f.deleteDatabase(r);e.onsuccess=wrap((function(){I||me.dbnames.delete(r).catch(nop);n()}));e.onerror=eventRejectHandler(t);e.onblocked=fireOnBlocked}}))};(this||n).backendDB=function(){return b};(this||n).isOpen=function(){return null!==b};(this||n).hasBeenClosed=function(){return w&&w instanceof P.DatabaseClosed};(this||n).hasFailed=function(){return null!==w};(this||n).dynamicallyOpened=function(){return O};(this||n).name=r;props(this||n,{tables:{get:function(){return e(g).map((function(e){return g[e]}))}}});(this||n).on=Events(this||n,"populate","blocked","versionchange",{ready:[promisableChain,nop]});(this||n).on.ready.subscribe=override((this||n).on.ready.subscribe,(function(e){return function(n,t){Dexie.vip((function(){if(x){w||Promise.resolve().then(n);t&&e(n)}else if(_){_.push(n);t&&e(n)}else{e(n);t||e((function unsubscribe(){C.on.ready.unsubscribe(n);C.on.ready.unsubscribe(unsubscribe)}))}}))}}));(this||n).transaction=function(){var e=extractTransactionArgs.apply(this||n,arguments);return(this||n)._transaction.apply(this||n,e)};function extractTransactionArgs(e,n,t){var r=arguments.length;if(r<2)throw new P.InvalidArgument("Too few arguments");var i=new Array(r-1);while(--r)i[r-1]=arguments[r];t=i.pop();var o=flatten(i);return[e,o,t]}(this||n)._transaction=function(e,n,t){var r=G.trans;r&&r.db===C&&-1===e.indexOf("!")||(r=null);var i=-1!==e.indexOf("?");e=e.replace("!","").replace("?","");try{var o=n.map((function(e){var n=e instanceof Table?e.name:e;if("string"!==typeof n)throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return n}));if("r"==e||e==S)e=S;else{if("rw"!=e&&e!=E)throw new P.InvalidArgument("Invalid transaction mode: "+e);e=E}if(r){if(r.mode===S&&e===E){if(!i)throw new P.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");r=null}r&&o.forEach((function(e){if(r&&-1===r.storeNames.indexOf(e)){if(!i)throw new P.SubTransaction("Table "+e+" not included in parent transaction.");r=null}}));i&&r&&!r.active&&(r=null)}}catch(e){return r?r._promise(null,(function(n,t){t(e)})):ae(e)}return r?r._promise(e,enterTransactionScope,"lock"):G.trans?usePSD(G.transless,(function(){return C._whenReady(enterTransactionScope)})):C._whenReady(enterTransactionScope);function enterTransactionScope(){return Promise.resolve().then((function(){var n=G.transless||G;var i=C._createTransaction(e,o,d,r);var a={trans:i,transless:n};r?i.idbtrans=r.idbtrans:i.create();t.constructor===F&&incrementExpectedAwaits();var s;var u=Promise.follow((function(){s=t.call(i,i);if(s)if(s.constructor===R){var e=decrementExpectedAwaits.bind(null,null);s.then(e,e)}else"function"===typeof s.next&&"function"===typeof s.throw&&(s=awaitIterator(s))}),a);return(s&&"function"===typeof s.then?Promise.resolve(s).then((function(e){return i.active?e:ae(new P.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))})):u.then((function(){return s}))).then((function(e){r&&i._resolve();return i._completion.then((function(){return e}))})).catch((function(e){i._reject(e);return ae(e)}))}))}};(this||n).table=function(e){if(!hasOwn(g,e))throw new P.InvalidTable("Table "+e+" does not exist");return g[e]};function Table(e,t,r){(this||n).name=e;(this||n).schema=t;(this||n)._tx=r;(this||n).hook=g[e]?g[e].hook:Events(null,{creating:[hookCreatingChain,nop],reading:[pureFunctionChain,mirror],updating:[hookUpdatingChain,nop],deleting:[hookDeletingChain,nop]})}function BulkErrorHandlerCatchAll(e,n,t){return(t?hookedEventRejectHandler:eventRejectHandler)((function(t){e.push(t);n&&n()}))}function bulkDelete(e,n,t,r,i){return new Promise((function(o,a){var s=t.length,u=s-1;if(0===s)return o();if(r){var l,f=hookedEventRejectHandler(a),h=hookedEventSuccessHandler(null);tryCatch((function(){for(var r=0;r<s;++r){l={onsuccess:null,onerror:null};var a=t[r];i.call(l,a[0],a[1],n);var d=e.delete(a[0]);d._hookCtx=l;d.onerror=f;d.onsuccess=r===u?hookedEventSuccessHandler(o):h}}),(function(e){l.onerror&&l.onerror(e);throw e}))}else for(var d=0;d<s;++d){var p=e.delete(t[d]);p.onerror=eventRejectHandler(a);d===u&&(p.onsuccess=wrap((function(){return o()})))}}))}props(Table.prototype,{_trans:function getTransaction(e,t,r){var i=(this||n)._tx||G.trans;return i&&i.db===C?i===G.trans?i._promise(e,t,r):newScope((function(){return i._promise(e,t,r)}),{trans:i,transless:G.transless||G}):tempTransaction(e,[(this||n).name],t)},_idbstore:function getIDBObjectStore(e,t,r){var i=(this||n).name;function supplyIdbStore(e,n,r){if(-1===r.storeNames.indexOf(i))throw new P.NotFound("Table"+i+" not part of transaction");return t(e,n,r.idbtrans.objectStore(i),r)}return this._trans(e,supplyIdbStore,r)},get:function(e,t){if(e&&e.constructor===Object)return this.where(e).first(t);var r=this||n;return this._idbstore(S,(function(n,t,i){var o=i.get(e);o.onerror=eventRejectHandler(t);o.onsuccess=wrap((function(){n(r.hook.reading.fire(o.result))}),t)})).then(t)},where:function(r){if("string"===typeof r)return new WhereClause(this||n,r);if(t(r))return new WhereClause(this||n,"["+r.join("+")+"]");var i=e(r);if(1===i.length)return this.where(i[0]).equals(r[i[0]]);var o=(this||n).schema.indexes.concat((this||n).schema.primKey).filter((function(e){return e.compound&&i.every((function(n){return e.keyPath.indexOf(n)>=0}))&&e.keyPath.every((function(e){return i.indexOf(e)>=0}))}))[0];if(o&&ce!==ue)return this.where(o.name).equals(o.keyPath.map((function(e){return r[e]})));o||console.warn("The query "+JSON.stringify(r)+" on "+(this||n).name+" would benefit of a "+"compound index ["+i.join("+")+"]");var a=(this||n).schema.idxByName;var s=i.reduce((function(e,n){return[e[0]||a[n],e[0]||!a[n]?combine(e[1],(function(e){return""+getByKeyPath(e,n)==""+r[n]})):e[1]]}),[null,null]);var u=s[0];return u?this.where(u.name).equals(r[u.keyPath]).filter(s[1]):o?this.filter(s[1]):this.where(i).equals("")},count:function(e){return this.toCollection().count(e)},offset:function(e){return this.toCollection().offset(e)},limit:function(e){return this.toCollection().limit(e)},reverse:function(){return this.toCollection().reverse()},filter:function(e){return this.toCollection().and(e)},each:function(e){return this.toCollection().each(e)},toArray:function(e){return this.toCollection().toArray(e)},orderBy:function(e){return new Collection(new WhereClause(this||n,t(e)?"["+e.join("+")+"]":e))},toCollection:function(){return new Collection(new WhereClause(this||n))},mapToClass:function(e,t){(this||n).schema.mappedClass=e;var r=Object.create(e.prototype);t&&applyStructure(r,t);(this||n).schema.instanceTemplate=r;var readHook=function(n){if(!n)return n;var t=Object.create(e.prototype);for(var r in n)if(hasOwn(n,r))try{t[r]=n[r]}catch(e){}return t};(this||n).schema.readHook&&(this||n).hook.reading.unsubscribe((this||n).schema.readHook);(this||n).schema.readHook=readHook;this.hook("reading",readHook);return e},defineClass:function(e){return this.mapToClass(Dexie.defineClass(e),e)},bulkDelete:function(e){return(this||n).hook.deleting.fire===nop?this._idbstore(E,(function(n,t,r,i){n(bulkDelete(r,i,e,false,nop))})):this.where(":id").anyOf(e).delete().then((function(){}))},bulkPut:function(e,t){var r=this||n;return this._idbstore(E,(function(i,o,a){if(!a.keyPath&&!r.schema.primKey.auto&&!t)throw new P.InvalidArgument("bulkPut() with non-inbound keys requires keys array in second argument");if(a.keyPath&&t)throw new P.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(t&&t.length!==e.length)throw new P.InvalidArgument("Arguments objects and keys must have the same length");if(0===e.length)return i();var done=function(e){0===u.length?i(e):o(new BulkError(r.name+".bulkPut(): "+u.length+" of "+f+" operations failed",u))};var s,u=[],l,f=e.length,h=r;if(r.hook.creating.fire===nop&&r.hook.updating.fire===nop){l=BulkErrorHandlerCatchAll(u);for(var d=0,p=e.length;d<p;++d){s=t?a.put(e[d],t[d]):a.put(e[d]);s.onerror=l}s.onerror=BulkErrorHandlerCatchAll(u,done);s.onsuccess=eventSuccessHandler(done)}else{var v=t||a.keyPath&&e.map((function(e){return getByKeyPath(e,a.keyPath)}));var y=v&&arrayToObject(v,(function(n,t){return null!=n&&[n,e[t]]}));var m=v?h.where(":id").anyOf(v.filter((function(e){return null!=e}))).modify((function(){(this||n).value=y[(this||n).primKey];y[(this||n).primKey]=null})).catch(ModifyError,(function(e){u=e.failures})).then((function(){var n=[],r=t&&[];for(var i=v.length-1;i>=0;--i){var o=v[i];if(null==o||y[o]){n.push(e[i]);t&&r.push(o);null!=o&&(y[o]=null)}}n.reverse();t&&r.reverse();return h.bulkAdd(n,r)})).then((function(e){var n=v[v.length-1];return null!=n?n:e})):h.bulkAdd(e);m.then(done).catch(BulkError,(function(e){u=u.concat(e.failures);done()})).catch(o)}}),"locked")},bulkAdd:function(e,t){var r=this||n,i=(this||n).hook.creating.fire;return this._idbstore(E,(function(n,o,a,s){if(!a.keyPath&&!r.schema.primKey.auto&&!t)throw new P.InvalidArgument("bulkAdd() with non-inbound keys requires keys array in second argument");if(a.keyPath&&t)throw new P.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(t&&t.length!==e.length)throw new P.InvalidArgument("Arguments objects and keys must have the same length");if(0===e.length)return n();function done(e){0===l.length?n(e):o(new BulkError(r.name+".bulkAdd(): "+l.length+" of "+d+" operations failed",l))}var u,l=[],f,h,d=e.length;if(i!==nop){var p=a.keyPath,v;f=BulkErrorHandlerCatchAll(l,null,true);h=hookedEventSuccessHandler(null);tryCatch((function(){for(var n=0,r=e.length;n<r;++n){v={onerror:null,onsuccess:null};var o=t&&t[n];var l=e[n],d=t?o:p?getByKeyPath(l,p):void 0,y=i.call(v,d,l,s);if(null==d&&null!=y)if(p){l=deepClone(l);setByKeyPath(l,p,y)}else o=y;u=null!=o?a.add(l,o):a.add(l);u._hookCtx=v;if(n<r-1){u.onerror=f;v.onsuccess&&(u.onsuccess=h)}}}),(function(e){v.onerror&&v.onerror(e);throw e}));u.onerror=BulkErrorHandlerCatchAll(l,done,true);u.onsuccess=hookedEventSuccessHandler(done)}else{f=BulkErrorHandlerCatchAll(l);for(var y=0,m=e.length;y<m;++y){u=t?a.add(e[y],t[y]):a.add(e[y]);u.onerror=f}u.onerror=BulkErrorHandlerCatchAll(l,done);u.onsuccess=eventSuccessHandler(done)}}))},add:function(e,t){var r=(this||n).hook.creating.fire;return this._idbstore(E,(function(n,i,o,a){var s={onsuccess:null,onerror:null};if(r!==nop){var u=null!=t?t:o.keyPath?getByKeyPath(e,o.keyPath):void 0;var l=r.call(s,u,e,a);null==u&&null!=l&&(o.keyPath?setByKeyPath(e,o.keyPath,l):t=l)}try{var f=null!=t?o.add(e,t):o.add(e);f._hookCtx=s;f.onerror=hookedEventRejectHandler(i);f.onsuccess=hookedEventSuccessHandler((function(t){var r=o.keyPath;r&&setByKeyPath(e,r,t);n(t)}))}catch(e){s.onerror&&s.onerror(e);throw e}}))},put:function(e,t){var r=this||n;var i=(this||n).hook.creating.fire,o=(this||n).hook.updating.fire;if(i!==nop||o!==nop){var a=(this||n).schema.primKey.keyPath;var s=void 0!==t?t:a&&getByKeyPath(e,a);if(null==s)return this.add(e);e=deepClone(e);return this._trans(E,(function(){return r.where(":id").equals(s).modify((function(){(this||n).value=e})).then((function(n){return 0===n?r.add(e,t):s}))}),"locked")}return this._idbstore(E,(function(n,r,i){var o=void 0!==t?i.put(e,t):i.put(e);o.onerror=eventRejectHandler(r);o.onsuccess=wrap((function(t){var r=i.keyPath;r&&setByKeyPath(e,r,t.target.result);n(o.result)}))}))},delete:function(e){return(this||n).hook.deleting.subscribers.length?this.where(":id").equals(e).delete():this._idbstore(E,(function(n,t,r){var i=r.delete(e);i.onerror=eventRejectHandler(t);i.onsuccess=wrap((function(){n(i.result)}))}))},clear:function(){return(this||n).hook.deleting.subscribers.length?this.toCollection().delete():this._idbstore(E,(function(e,n,t){var r=t.clear();r.onerror=eventRejectHandler(n);r.onsuccess=wrap((function(){e(r.result)}))}))},update:function(r,i){if("object"!==typeof i||t(i))throw new P.InvalidArgument("Modifications must be an object.");if("object"!==typeof r||t(r))return this.where(":id").equals(r).modify(i);e(i).forEach((function(e){setByKeyPath(r,e,i[e])}));var o=getByKeyPath(r,(this||n).schema.primKey.keyPath);return void 0===o?ae(new P.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(o).modify(i)}});function Transaction(e,t,r,i){var o=this||n;(this||n).db=C;(this||n).mode=e;(this||n).storeNames=t;(this||n).idbtrans=null;(this||n).on=Events(this||n,"complete","error","abort");(this||n).parent=i||null;(this||n).active=true;(this||n)._reculock=0;(this||n)._blockedFuncs=[];(this||n)._resolve=null;(this||n)._reject=null;(this||n)._waitingFor=null;(this||n)._waitingQueue=null;(this||n)._spinCount=0;(this||n)._completion=new Promise((function(e,n){o._resolve=e;o._reject=n}));(this||n)._completion.then((function(){o.active=false;o.on.complete.fire()}),(function(e){var n=o.active;o.active=false;o.on.error.fire(e);o.parent?o.parent._reject(e):n&&o.idbtrans&&o.idbtrans.abort();return ae(e)}))}props(Transaction.prototype,{_lock:function(){assert(!G.global);++(this||n)._reculock;1!==(this||n)._reculock||G.global||(G.lockOwnerFor=this||n);return this||n},_unlock:function(){assert(!G.global);if(0===--(this||n)._reculock){G.global||(G.lockOwnerFor=null);while((this||n)._blockedFuncs.length>0&&!this._locked()){var e=(this||n)._blockedFuncs.shift();try{usePSD(e[1],e[0])}catch(e){}}}return this||n},_locked:function(){return(this||n)._reculock&&G.lockOwnerFor!==(this||n)},create:function(e){var t=this||n;if(!(this||n).mode)return this||n;assert(!(this||n).idbtrans);if(!e&&!b)switch(w&&w.name){case"DatabaseClosedError":throw new P.DatabaseClosed(w);case"MissingAPIError":throw new P.MissingAPI(w.message,w);default:throw new P.OpenFailed(w)}if(!(this||n).active)throw new P.TransactionInactive;assert(null===(this||n)._completion._state);e=(this||n).idbtrans=e||b.transaction(safariMultiStoreFix((this||n).storeNames),(this||n).mode);e.onerror=wrap((function(n){preventDefault(n);t._reject(e.error)}));e.onabort=wrap((function(n){preventDefault(n);t.active&&t._reject(new P.Abort(e.error));t.active=false;t.on("abort").fire(n)}));e.oncomplete=wrap((function(){t.active=false;t._resolve()}));return this||n},_promise:function(e,t,r){var i=this||n;if(e===E&&(this||n).mode!==E)return ae(new P.ReadOnly("Transaction is readonly"));if(!(this||n).active)return ae(new P.TransactionInactive);if(this._locked())return new Promise((function(n,o){i._blockedFuncs.push([function(){i._promise(e,t,r).then(n,o)},G])}));if(r)return newScope((function(){var e=new Promise((function(e,n){i._lock();var r=t(e,n,i);r&&r.then&&r.then(e,n)}));e.finally((function(){return i._unlock()}));e._lib=true;return e}));var o=new Promise((function(e,n){var r=t(e,n,i);r&&r.then&&r.then(e,n)}));o._lib=true;return o},_root:function(){return(this||n).parent?(this||n).parent._root():this||n},waitFor:function(e){var n=this._root();e=Promise.resolve(e);if(n._waitingFor)n._waitingFor=n._waitingFor.then((function(){return e}));else{n._waitingFor=e;n._waitingQueue=[];var t=n.idbtrans.objectStore(n.storeNames[0]);(function spin(){++n._spinCount;while(n._waitingQueue.length)n._waitingQueue.shift()();n._waitingFor&&(t.get(-Infinity).onsuccess=spin)})()}var r=n._waitingFor;return new Promise((function(t,i){e.then((function(e){return n._waitingQueue.push(wrap(t.bind(null,e)))}),(function(e){return n._waitingQueue.push(wrap(i.bind(null,e)))})).finally((function(){n._waitingFor===r&&(n._waitingFor=null)}))}))},abort:function(){(this||n).active&&this._reject(new P.Abort);(this||n).active=false},tables:{get:deprecated("Transaction.tables",(function(){return g}))},table:function(e){var t=C.table(e);return new Table(e,t.schema,this||n)}});function WhereClause(e,t,r){(this||n)._ctx={table:e,index:":id"===t?null:t,or:r}}props(WhereClause.prototype,(function(){function fail(e,n,t){var r=e instanceof WhereClause?new Collection(e):e;r._ctx.error=t?new t(n):new TypeError(n);return r}function emptyCollection(e){return new Collection(e,(function(){return h.only("")})).limit(0)}function upperFactory(e){return"next"===e?function(e){return e.toUpperCase()}:function(e){return e.toLowerCase()}}function lowerFactory(e){return"next"===e?function(e){return e.toLowerCase()}:function(e){return e.toUpperCase()}}function nextCasing(e,n,t,r,i,o){var a=Math.min(e.length,r.length);var s=-1;for(var u=0;u<a;++u){var l=n[u];if(l!==r[u])return i(e[u],t[u])<0?e.substr(0,u)+t[u]+t.substr(u+1):i(e[u],r[u])<0?e.substr(0,u)+r[u]+t.substr(u+1):s>=0?e.substr(0,s)+n[s]+t.substr(s+1):null;i(e[u],l)<0&&(s=u)}return a<r.length&&"next"===o?e+t.substr(e.length):a<e.length&&"prev"===o?e.substr(0,t.length):s<0?null:e.substr(0,s)+r[s]+t.substr(s+1)}function addIgnoreCaseAlgorithm(e,n,t,r){var i,o,a,s,u,l,f,d=t.length;if(!t.every((function(e){return"string"===typeof e})))return fail(e,he);function initDirection(e){i=upperFactory(e);o=lowerFactory(e);a="next"===e?simpleCompare:simpleCompareReverse;var n=t.map((function(e){return{lower:o(e),upper:i(e)}})).sort((function(e,n){return a(e.lower,n.lower)}));s=n.map((function(e){return e.upper}));u=n.map((function(e){return e.lower}));l=e;f="next"===e?"":r}initDirection("next");var p=new Collection(e,(function(){return h.bound(s[0],u[d-1]+r)}));p._ondirectionchange=function(e){initDirection(e)};var v=0;p._addAlgorithm((function(e,t,r){var i=e.key;if("string"!==typeof i)return false;var h=o(i);if(n(h,u,v))return true;var p=null;for(var y=v;y<d;++y){var m=nextCasing(i,h,s[y],u[y],a,l);null===m&&null===p?v=y+1:(null===p||a(p,m)>0)&&(p=m)}t(null!==p?function(){e.continue(p+f)}:r);return false}));return p}return{between:function(e,t,r,i){r=false!==r;i=true===i;try{return cmp(e,t)>0||0===cmp(e,t)&&(r||i)&&!(r&&i)?emptyCollection(this||n):new Collection(this||n,(function(){return h.bound(e,t,!r,!i)}))}catch(e){return fail(this||n,fe)}},equals:function(e){return new Collection(this||n,(function(){return h.only(e)}))},above:function(e){return new Collection(this||n,(function(){return h.lowerBound(e,true)}))},aboveOrEqual:function(e){return new Collection(this||n,(function(){return h.lowerBound(e)}))},below:function(e){return new Collection(this||n,(function(){return h.upperBound(e,true)}))},belowOrEqual:function(e){return new Collection(this||n,(function(){return h.upperBound(e)}))},startsWith:function(e){return"string"!==typeof e?fail(this||n,he):this.between(e,e+ue,true,true)},startsWithIgnoreCase:function(e){return""===e?this.startsWith(e):addIgnoreCaseAlgorithm(this||n,(function(e,n){return 0===e.indexOf(n[0])}),[e],ue)},equalsIgnoreCase:function(e){return addIgnoreCaseAlgorithm(this||n,(function(e,n){return e===n[0]}),[e],"")},anyOfIgnoreCase:function(){var e=getArrayOf.apply(v,arguments);return 0===e.length?emptyCollection(this||n):addIgnoreCaseAlgorithm(this||n,(function(e,n){return-1!==n.indexOf(e)}),e,"")},startsWithAnyOfIgnoreCase:function(){var e=getArrayOf.apply(v,arguments);return 0===e.length?emptyCollection(this||n):addIgnoreCaseAlgorithm(this||n,(function(e,n){return n.some((function(n){return 0===e.indexOf(n)}))}),e,ue)},anyOf:function(){var e=getArrayOf.apply(v,arguments);var t=ascending;try{e.sort(t)}catch(e){return fail(this||n,fe)}if(0===e.length)return emptyCollection(this||n);var r=new Collection(this||n,(function(){return h.bound(e[0],e[e.length-1])}));r._ondirectionchange=function(n){t="next"===n?ascending:descending;e.sort(t)};var i=0;r._addAlgorithm((function(n,r,o){var a=n.key;while(t(a,e[i])>0){++i;if(i===e.length){r(o);return false}}if(0===t(a,e[i]))return true;r((function(){n.continue(e[i])}));return false}));return r},notEqual:function(e){return this.inAnyRange([[le,e],[e,ce]],{includeLowers:false,includeUppers:false})},noneOf:function(){var e=getArrayOf.apply(v,arguments);if(0===e.length)return new Collection(this||n);try{e.sort(ascending)}catch(e){return fail(this||n,fe)}var t=e.reduce((function(e,n){return e?e.concat([[e[e.length-1][1],n]]):[[le,n]]}),null);t.push([e[e.length-1],ce]);return this.inAnyRange(t,{includeLowers:false,includeUppers:false})},inAnyRange:function(e,t){if(0===e.length)return emptyCollection(this||n);if(!e.every((function(e){return void 0!==e[0]&&void 0!==e[1]&&ascending(e[0],e[1])<=0})))return fail(this||n,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",P.InvalidArgument);var r=!t||false!==t.includeLowers;var i=t&&true===t.includeUppers;function addRange(e,n){for(var t=0,r=e.length;t<r;++t){var i=e[t];if(cmp(n[0],i[1])<0&&cmp(n[1],i[0])>0){i[0]=min(i[0],n[0]);i[1]=max(i[1],n[1]);break}}t===r&&e.push(n);return e}var o=ascending;function rangeSorter(e,n){return o(e[0],n[0])}var a;try{a=e.reduce(addRange,[]);a.sort(rangeSorter)}catch(e){return fail(this||n,fe)}var s=0;var u=i?function(e){return ascending(e,a[s][1])>0}:function(e){return ascending(e,a[s][1])>=0};var l=r?function(e){return descending(e,a[s][0])>0}:function(e){return descending(e,a[s][0])>=0};function keyWithinCurrentRange(e){return!u(e)&&!l(e)}var f=u;var d=new Collection(this||n,(function(){return h.bound(a[0][0],a[a.length-1][1],!r,!i)}));d._ondirectionchange=function(e){if("next"===e){f=u;o=ascending}else{f=l;o=descending}a.sort(rangeSorter)};d._addAlgorithm((function(e,n,t){var r=e.key;while(f(r)){++s;if(s===a.length){n(t);return false}}if(keyWithinCurrentRange(r))return true;if(0===cmp(r,a[s][1])||0===cmp(r,a[s][0]))return false;n((function(){o===ascending?e.continue(a[s][0]):e.continue(a[s][1])}));return false}));return d},startsWithAnyOf:function(){var e=getArrayOf.apply(v,arguments);return e.every((function(e){return"string"===typeof e}))?0===e.length?emptyCollection(this||n):this.inAnyRange(e.map((function(e){return[e,e+ue]}))):fail(this||n,"startsWithAnyOf() only works with strings")}}}));function Collection(e,t){var r=null,i=null;if(t)try{r=t()}catch(e){i=e}var o=e._ctx,a=o.table;(this||n)._ctx={table:a,index:o.index,isPrimKey:!o.index||a.schema.primKey.keyPath&&o.index===a.schema.primKey.name,range:r,keysOnly:false,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:true,isMatch:null,offset:0,limit:Infinity,error:i,or:o.or,valueMapper:a.hook.reading.fire}}function isPlainKeyRange(e,n){return!(e.filter||e.algorithm||e.or)&&(n?e.justLimit:!e.replayFilter)}props(Collection.prototype,(function(){function addFilter(e,n){e.filter=combine(e.filter,n)}function addReplayFilter(e,n,t){var r=e.replayFilter;e.replayFilter=r?function(){return combine(r(),n())}:n;e.justLimit=t&&!r}function addMatchFilter(e,n){e.isMatch=combine(e.isMatch,n)}function getIndexOrStore(e,n){if(e.isPrimKey)return n;var t=e.table.schema.idxByName[e.index];if(!t)throw new P.Schema("KeyPath "+e.index+" on object store "+n.name+" is not indexed");return n.index(t.name)}function openCursor(e,n){var t=getIndexOrStore(e,n);return e.keysOnly&&"openKeyCursor"in t?t.openKeyCursor(e.range||null,e.dir+e.unique):t.openCursor(e.range||null,e.dir+e.unique)}function iter(e,n,t,r,i){var o=e.replayFilter?combine(e.filter,e.replayFilter()):e.filter;e.or?function(){var a={};var s=0;function resolveboth(){2===++s&&t()}function union(e,t,i){if(!o||o(t,i,resolveboth,r)){var s=t.primaryKey;var u=""+s;"[object ArrayBuffer]"===u&&(u=""+new Uint8Array(s));if(!hasOwn(a,u)){a[u]=true;n(e,t,i)}}}e.or._iterate(union,resolveboth,r,i);iterate(openCursor(e,i),e.algorithm,union,resolveboth,r,!e.keysOnly&&e.valueMapper)}():iterate(openCursor(e,i),combine(e.algorithm,o),n,t,r,!e.keysOnly&&e.valueMapper)}return{_read:function(e,t){var r=(this||n)._ctx;return r.error?r.table._trans(null,ae.bind(null,r.error)):r.table._idbstore(S,e).then(t)},_write:function(e){var t=(this||n)._ctx;return t.error?t.table._trans(null,ae.bind(null,t.error)):t.table._idbstore(E,e,"locked")},_addAlgorithm:function(e){var t=(this||n)._ctx;t.algorithm=combine(t.algorithm,e)},_iterate:function(e,t,r,i){return iter((this||n)._ctx,e,t,r,i)},clone:function(e){var t=Object.create((this||n).constructor.prototype),r=Object.create((this||n)._ctx);e&&extend(r,e);t._ctx=r;return t},raw:function(){(this||n)._ctx.valueMapper=null;return this||n},each:function(e){var t=(this||n)._ctx;return this._read((function(n,r,i){iter(t,e,n,r,i)}))},count:function(e){var t=(this||n)._ctx;if(isPlainKeyRange(t,true))return this._read((function(e,n,r){var i=getIndexOrStore(t,r);var o=t.range?i.count(t.range):i.count();o.onerror=eventRejectHandler(n);o.onsuccess=function(n){e(Math.min(n.target.result,t.limit))}}),e);var r=0;return this._read((function(e,n,i){iter(t,(function(){++r;return false}),(function(){e(r)}),n,i)}),e)},sortBy:function(e,t){var r=e.split(".").reverse(),i=r[0],o=r.length-1;function getval(e,n){return n?getval(e[r[n]],n-1):e[i]}var a="next"===(this||n)._ctx.dir?1:-1;function sorter(e,n){var t=getval(e,o),r=getval(n,o);return t<r?-a:t>r?a:0}return this.toArray((function(e){return e.sort(sorter)})).then(t)},toArray:function(e){var t=(this||n)._ctx;return this._read((function(e,n,r){if(B&&"next"===t.dir&&isPlainKeyRange(t,true)&&t.limit>0){var i=t.table.hook.reading.fire;var o=getIndexOrStore(t,r);var a=t.limit<Infinity?o.getAll(t.range,t.limit):o.getAll(t.range);a.onerror=eventRejectHandler(n);a.onsuccess=eventSuccessHandler(i===mirror?e:function(t){try{e(t.map(i))}catch(e){n(e)}})}else{var s=[];iter(t,(function(e){s.push(e)}),(function arrayComplete(){e(s)}),n,r)}}),e)},offset:function(e){var t=(this||n)._ctx;if(e<=0)return this||n;t.offset+=e;isPlainKeyRange(t)?addReplayFilter(t,(function(){var n=e;return function(e,t){if(0===n)return true;if(1===n){--n;return false}t((function(){e.advance(n);n=0}));return false}})):addReplayFilter(t,(function(){var n=e;return function(){return--n<0}}));return this||n},limit:function(e){(this||n)._ctx.limit=Math.min((this||n)._ctx.limit,e);addReplayFilter((this||n)._ctx,(function(){var n=e;return function(e,t,r){--n<=0&&t(r);return n>=0}}),true);return this||n},until:function(e,t){addFilter((this||n)._ctx,(function(n,r,i){if(e(n.value)){r(i);return t}return true}));return this||n},first:function(e){return this.limit(1).toArray((function(e){return e[0]})).then(e)},last:function(e){return this.reverse().first(e)},filter:function(e){addFilter((this||n)._ctx,(function(n){return e(n.value)}));addMatchFilter((this||n)._ctx,e);return this||n},and:function(e){return this.filter(e)},or:function(e){return new WhereClause((this||n)._ctx.table,e,this||n)},reverse:function(){(this||n)._ctx.dir="prev"===(this||n)._ctx.dir?"next":"prev";(this||n)._ondirectionchange&&this._ondirectionchange((this||n)._ctx.dir);return this||n},desc:function(){return this.reverse()},eachKey:function(e){var t=(this||n)._ctx;t.keysOnly=!t.isMatch;return this.each((function(n,t){e(t.key,t)}))},eachUniqueKey:function(e){(this||n)._ctx.unique="unique";return this.eachKey(e)},eachPrimaryKey:function(e){var t=(this||n)._ctx;t.keysOnly=!t.isMatch;return this.each((function(n,t){e(t.primaryKey,t)}))},keys:function(e){var t=(this||n)._ctx;t.keysOnly=!t.isMatch;var r=[];return this.each((function(e,n){r.push(n.key)})).then((function(){return r})).then(e)},primaryKeys:function(e){var t=(this||n)._ctx;if(B&&"next"===t.dir&&isPlainKeyRange(t,true)&&t.limit>0)return this._read((function(e,n,r){var i=getIndexOrStore(t,r);var o=t.limit<Infinity?i.getAllKeys(t.range,t.limit):i.getAllKeys(t.range);o.onerror=eventRejectHandler(n);o.onsuccess=eventSuccessHandler(e)})).then(e);t.keysOnly=!t.isMatch;var r=[];return this.each((function(e,n){r.push(n.primaryKey)})).then((function(){return r})).then(e)},uniqueKeys:function(e){(this||n)._ctx.unique="unique";return this.keys(e)},firstKey:function(e){return this.limit(1).keys((function(e){return e[0]})).then(e)},lastKey:function(e){return this.reverse().firstKey(e)},distinct:function(){var e=(this||n)._ctx,t=e.index&&e.table.schema.idxByName[e.index];if(!t||!t.multi)return this||n;var r={};addFilter((this||n)._ctx,(function(e){var n=e.primaryKey.toString();var t=hasOwn(r,n);r[n]=true;return!t}));return this||n},modify:function(t){var r=this||n,i=(this||n)._ctx,o=i.table.hook,a=o.updating.fire,s=o.deleting.fire;return this._write((function(i,o,u,l){var f;if("function"===typeof t)f=a===nop&&s===nop?t:function(r){var i=deepClone(r);if(false===t.call(this||n,r,this||n))return false;if(hasOwn(this||n,"value")){var o=getObjectDiff(i,(this||n).value);var u=a.call(this||n,o,(this||n).primKey,i,l);if(u){r=(this||n).value;e(u).forEach((function(e){setByKeyPath(r,e,u[e])}))}}else s.call(this||n,(this||n).primKey,r,l)};else if(a===nop){var h=e(t);var d=h.length;f=function(e){var n=false;for(var r=0;r<d;++r){var i=h[r],o=t[i];if(getByKeyPath(e,i)!==o){setByKeyPath(e,i,o);n=true}}return n}}else{var p=t;t=shallowClone(p);f=function(r){var i=false;var o=a.call(this||n,t,(this||n).primKey,deepClone(r),l);o&&extend(t,o);e(t).forEach((function(e){var n=t[e];if(getByKeyPath(r,e)!==n){setByKeyPath(r,e,n);i=true}}));o&&(t=shallowClone(p));return i}}var v=0;var y=0;var m=false;var g=[];var b=[];var w=null;function modifyItem(e,n){w=n.primaryKey;var t={primKey:n.primaryKey,value:e,onsuccess:null,onerror:null};function onerror(e){g.push(e);b.push(t.primKey);checkFinished();return true}if(false!==f.call(t,e,t)){var r=!hasOwn(t,"value");++v;tryCatch((function(){var e=r?n.delete():n.update(t.value);e._hookCtx=t;e.onerror=hookedEventRejectHandler(onerror);e.onsuccess=hookedEventSuccessHandler((function(){++y;checkFinished()}))}),onerror)}else t.onsuccess&&t.onsuccess(t.value)}function doReject(e){if(e){g.push(e);b.push(w)}return o(new ModifyError("Error modifying one or more objects",g,y,b))}function checkFinished(){m&&y+g.length===v&&(g.length>0?doReject():i(y))}r.clone().raw()._iterate(modifyItem,(function(){m=true;checkFinished()}),doReject,u)}))},delete:function(){var e=this||n;var t=(this||n)._ctx,r=t.range,i=t.table.hook.deleting.fire,o=i!==nop;if(!o&&isPlainKeyRange(t)&&(t.isPrimKey&&!ye||!r))return this._write((function(e,n,t){var i=eventRejectHandler(n),o=r?t.count(r):t.count();o.onerror=i;o.onsuccess=function(){var a=o.result;tryCatch((function(){var n=r?t.delete(r):t.clear();n.onerror=i;n.onsuccess=function(){return e(a)}}),(function(e){return n(e)}))}}));var a=o?2e3:1e4;return this._write((function(n,r,s,u){var l=0;var f=e.clone({keysOnly:!t.isMatch&&!o}).distinct().limit(a).raw();var h=[];var nextChunk=function(){return f.each(o?function(e,n){h.push([n.primaryKey,n.value])}:function(e,n){h.push(n.primaryKey)}).then((function(){o?h.sort((function(e,n){return ascending(e[0],n[0])})):h.sort(ascending);return bulkDelete(s,u,h,o,i)})).then((function(){var e=h.length;l+=e;h=[];return e<a?l:nextChunk()}))};n(nextChunk())}))}}}));function lowerVersionFirst(e,n){return e._cfg.version-n._cfg.version}function setApiOnPlace(e,n,t){n.forEach((function(n){var r=t[n];e.forEach((function(e){n in e||(e===Transaction.prototype||e instanceof Transaction?setProp(e,n,{get:function(){return this.table(n)}}):e[n]=new Table(n,r))}))}))}function removeTablesApi(e){e.forEach((function(e){for(var n in e)e[n]instanceof Table&&delete e[n]}))}function iterate(e,n,t,r,i,o){var a=o?function(e,n,r){return t(o(e),n,r)}:t;var s=wrap(a,i);e.onerror||(e.onerror=eventRejectHandler(i));e.onsuccess=trycatcher(n?function filter_record(){var t=e.result;if(t){var c=function(){t.continue()};n(t,(function(e){c=e}),r,i)&&s(t.value,t,(function(e){c=e}));c()}else r()}:function filter_record(){var n=e.result;if(n){var c=function(){n.continue()};s(n.value,n,(function(e){c=e}));c()}else r()},i)}function parseIndexSyntax(e){var n=[];e.split(",").forEach((function(e){e=e.trim();var r=e.replace(/([&*]|\+\+)/g,"");var i=/^\[/.test(r)?r.match(/^\[(.*)\]$/)[1].split("+"):r;n.push(new IndexSpec(r,i||null,/\&/.test(e),/\*/.test(e),/\+\+/.test(e),t(i),/\./.test(e)))}));return n}function cmp(e,n){return f.cmp(e,n)}function min(e,n){return cmp(e,n)<0?e:n}function max(e,n){return cmp(e,n)>0?e:n}function ascending(e,n){return f.cmp(e,n)}function descending(e,n){return f.cmp(n,e)}function simpleCompare(e,n){return e<n?-1:e===n?0:1}function simpleCompareReverse(e,n){return e>n?-1:e===n?0:1}function combine(e,t){return e?t?function(){return e.apply(this||n,arguments)&&t.apply(this||n,arguments)}:e:t}function readGlobalSchema(){C.verno=b.version/10;C._dbSchema=d={};m=slice(b.objectStoreNames,0);if(0!==m.length){var n=b.transaction(safariMultiStoreFix(m),"readonly");m.forEach((function(e){var t=n.objectStore(e),r=t.keyPath,i=r&&"string"===typeof r&&-1!==r.indexOf(".");var o=new IndexSpec(r,r||"",false,false,!!t.autoIncrement,r&&"string"!==typeof r,i);var a=[];for(var s=0;s<t.indexNames.length;++s){var u=t.index(t.indexNames[s]);r=u.keyPath;i=r&&"string"===typeof r&&-1!==r.indexOf(".");var l=new IndexSpec(u.name,r,!!u.unique,!!u.multiEntry,false,r&&"string"!==typeof r,i);a.push(l)}d[e]=new TableSchema(e,o,a,{})}));setApiOnPlace([g],e(d),d)}}function adjustToExistingIndexNames(e,n){var t=n.db.objectStoreNames;for(var r=0;r<t.length;++r){var o=t[r];var a=n.objectStore(o);B="getAll"in a;for(var s=0;s<a.indexNames.length;++s){var u=a.indexNames[s];var l=a.index(u).keyPath;var f="string"===typeof l?l:"["+slice(l).join("+")+"]";if(e[o]){var h=e[o].idxByName[f];h&&(h.name=u)}}}/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&i.WorkerGlobalScope&&i instanceof i.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(B=false)}function fireOnBlocked(e){C.on("blocked").fire(e);de.filter((function(e){return e.name===C.name&&e!==C&&!e._vcFired})).map((function(n){return n.on("versionchange").fire(e)}))}extend(this||n,{Collection:Collection,Table:Table,Transaction:Transaction,Version:Version,WhereClause:WhereClause});init();u.forEach((function(e){e(C)}))}function parseType(e){if("function"===typeof e)return new e;if(t(e))return[parseType(e[0])];if(e&&"object"===typeof e){var n={};applyStructure(n,e);return n}return e}function applyStructure(n,t){e(t).forEach((function(e){var r=parseType(t[e]);n[e]=r}));return n}function hookedEventSuccessHandler(e){return wrap((function(n){var t=n.target,r=t._hookCtx,i=r.value||t.result,o=r&&r.onsuccess;o&&o(i);e&&e(i)}),e)}function eventRejectHandler(e){return wrap((function(n){preventDefault(n);e(n.target.error);return false}))}function eventSuccessHandler(e){return wrap((function(n){e(n.target.result)}))}function hookedEventRejectHandler(e){return wrap((function(n){var t=n.target,r=t.error,i=t._hookCtx,o=i&&i.onerror;o&&o(r);preventDefault(n);e(r);return false}))}function preventDefault(e){e.stopPropagation&&e.stopPropagation();e.preventDefault&&e.preventDefault()}function awaitIterator(e){var callNext=function(n){return e.next(n)},doThrow=function(n){return e.throw(n)},n=step(callNext),r=step(doThrow);function step(e){return function(i){var o=e(i),a=o.value;return o.done?a:a&&"function"===typeof a.then?a.then(n,r):t(a)?Promise.all(a).then(n,r):n(a)}}return step(callNext)()}function IndexSpec(e,t,r,i,o,a,s){(this||n).name=e;(this||n).keyPath=t;(this||n).unique=r;(this||n).multi=i;(this||n).auto=o;(this||n).compound=a;(this||n).dotted=s;var u="string"===typeof t?t:t&&"["+[].join.call(t,"+")+"]";(this||n).src=(r?"&":"")+(i?"*":"")+(o?"++":"")+u}function TableSchema(e,t,r,i){(this||n).name=e;(this||n).primKey=t||new IndexSpec;(this||n).indexes=r||[new IndexSpec];(this||n).instanceTemplate=i;(this||n).mappedClass=null;(this||n).idxByName=arrayToObject(r,(function(e){return[e.name,e]}))}function safariMultiStoreFix(e){return 1===e.length?e[0]:e}function getNativeGetDatabaseNamesFn(e){var n=e&&(e.getDatabaseNames||e.webkitGetDatabaseNames);return n&&n.bind(e)}props(Dexie,E);props(Dexie,{delete:function(e){var t=new Dexie(e),r=t.delete();r.onblocked=function(e){t.on("blocked",e);return this||n};return r},exists:function(e){return new Dexie(e).open().then((function(e){e.close();return true})).catch(Dexie.NoSuchDatabaseError,(function(){return false}))},getDatabaseNames:function(e){var n=getNativeGetDatabaseNamesFn(Dexie.dependencies.indexedDB);return n?new Promise((function(e,t){var r=n();r.onsuccess=function(n){e(slice(n.target.result,0))};r.onerror=eventRejectHandler(t)})).then(e):me.dbnames.toCollection().primaryKeys(e)},defineClass:function(){function Class(e){e&&extend(this||n,e)}return Class},applyStructure:applyStructure,ignoreTransaction:function(e){return G.trans?usePSD(G.transless,e):e()},vip:function(e){return newScope((function(){G.letThrough=true;return e()}))},async:function(e){return function(){try{var t=awaitIterator(e.apply(this||n,arguments));return t&&"function"===typeof t.then?t:Promise.resolve(t)}catch(e){return ae(e)}}},spawn:function(e,n,t){try{var r=awaitIterator(e.apply(t,n||[]));return r&&"function"===typeof r.then?r:Promise.resolve(r)}catch(e){return ae(e)}},currentTransaction:{get:function(){return G.trans||null}},waitFor:function(e,n){var t=Promise.resolve("function"===typeof e?Dexie.ignoreTransaction(e):e).timeout(n||6e4);return G.trans?G.trans.waitFor(t):t},Promise:Promise,debug:{get:function(){return y},set:function(e){setDebug(e,"dexie"===e?function(){return true}:dexieStackFrameFilter)}},derive:derive,extend:extend,props:props,override:override,Events:Events,getByKeyPath:getByKeyPath,setByKeyPath:setByKeyPath,delByKeyPath:delByKeyPath,shallowClone:shallowClone,deepClone:deepClone,getObjectDiff:getObjectDiff,asap:asap,maxKey:ce,minKey:le,addons:[],connections:de,MultiModifyError:P.Modify,errnames:_,IndexSpec:IndexSpec,TableSchema:TableSchema,dependencies:function(){try{return{indexedDB:i.indexedDB||i.mozIndexedDB||i.webkitIndexedDB||i.msIndexedDB,IDBKeyRange:i.IDBKeyRange||i.webkitIDBKeyRange}}catch(e){return{indexedDB:null,IDBKeyRange:null}}}(),semVer:se,version:se.split(".").map((function(e){return parseInt(e)})).reduce((function(e,n,t){return e+n/Math.pow(10,2*t)})),default:Dexie,Dexie:Dexie});Promise.rejectionMapper=mapError;me=new Dexie("__dbnames");me.version(1).stores({dbnames:"name"});(function(){var e="Dexie.DatabaseNames";try{if(void 0!==typeof localStorage&&void 0!==i.document){JSON.parse(localStorage.getItem(e)||"[]").forEach((function(e){return me.dbnames.put({name:e}).catch(nop)}));localStorage.removeItem(e)}}catch(e){}})();return Dexie}));var i=t;export default i;

